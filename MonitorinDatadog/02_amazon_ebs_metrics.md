# Amazon EBS

- Amazon Elastic Block Storage (EBS) 는 블록 레벨의 저장소이며 EC2에 붙는다. 
- EBS 볼륨은 2개의 타입이 있다. 
  - SSD (Solic-State-Drive)
  - HDD (Hard-Disk-Drive)
- 신뢰성, 오랜기간 저장 솔루션이다. 
- EBS 볼륨은 많은 AWS에서 중요한 레이어이다. 
- EBS는 볼륨 스냅샷을 S3버킷에 저장할 수 있다. 
- 그리고 복사하고, 리플리카를 AWS 리젼으로 이동하거나 어플리케이션 인프라의 스케일이 필요한경우 확장이 가능하다. 

## Metrics to Watch

- EBS 모니터링을 수행할때 다음 키 메트릭이 볼륨에 대한 사용성과 성능을 측정하는데 도움이 된다. 

### VolumeReadBytes and VolumeWriteBytes

- 이 메트릭 쌍은 특정 시간 범위에서 읽기/쓰기 바이트를 측정한 값이다. 
- 이는 다양한 집계 방법을 통해서 리포트 될 수 있다. 
- 예를 들어 특정 시간 범위에서 읽고/쓰기 수행한 바이트 총 수를 계산할 수 있거나 혹은 각 I/O 오퍼레이션의 평균 쿼리 크기등 이들은 EBS 워크로드를 프로파일링 하기 위한 유용한 기초를 제공한다. 
- 볼륨이 C5와 M5인스턴스에 첨부를 위해서 시간 범위에서 읽기/쓰기 바이트 평균 쿼리만 요청할 수 있다. 

### VolumeTotalReadTime and VolumeTotalWriteTime

- 이 메트릭은 토탈 소요된 시간을 리포트한다. 
- 초단위로 리포팅을 하며, 시간 프레임에서 모든 읽기/쓰기 오퍼레이션에 대한 작업이다. 
- 만약 latency 가 증가하는것을 확인했다면 이러한 지표를 처리량 지표와 연관시켜 EBS볼륨이 IOPS 한도에 도달했는지 확인할 수 있다. 

### VolumeQueueLength

- 볼륨 큐 길이 혹은 실행을 위해서 큐된 오퍼레이션의 대기 수이다. 
- 이는 EBS볼륨의 워크로드에 인사이트를 제공한다. 
- AWS는 SSD 볼륨에 사용 가능한 500IOPS당 1개의 대기열 길이를 목표로 하거나 HDD 볼륨에서 1MiB 순차 작업을 처리할 때 최소 4개의 대기열 길이를 목표로 할 것을 권장한다. 
- 그러나 볼륨 대기열 길이가 장기간 높은 상태로 유지되면 지연 시간이 늘어날 수 있다. 
- 볼륨 대기열 길이를 IOPS 및 볼륨 읽기/쓰기 시간과 같이 다른 지표와 연관시켜 볼륨에 워크로드를 관리하기에 충분한 프로비저닝된 IOPS가 있는지 확인 가능하다.

### VolumeIdleTime

- VolumeIdleTime 은 비활성화된 시간(초)를 측정한다.
- 이 메트릭을 통해서 프로비저닝된 리소스가 사용되지 않는지 확인할 수 있다. 
- 만약 I/O 수준 감소와 함께 유휴 시간이 갑자기 급증하는 경우 애플리케이션에 볼륨으로 요청을 보내지 못하게 하는 문제가 발생할 수 있다. 

### VolumeStatus

- AWS는 5분마다 상태 확인을 실행하여 EBS볼륨의 상태를 추적할 수 있도록 도와준다. 
- 만약 모든 체크가 통과되면 ok를 보게 될 것이다. 검사가 실패하면 손상된 것으로 표현되고, 검사가 완료되지 않은 경우에는 불충분한 데이터로 표시된다. 
- 프로비저닝된 IOPS 볼륨이 예상보다 낮은 성능을 보이는 경우 경고 상태를 보낼 수도 있다. 
- AWS는 볼륨 데이터에서 가능한 불일치를 감지하는 경우 볼륨에 대한 I/O 작업을 자동으로 비활성화 하고 다음 상태 확인은 기본적으로 실패한다. 
- AutoEnableIO 볼륨 속성을 구성하여 이러한 볼륨에서 I/O 를 수동으로 다시 활성화 할 수 있다. 
- 이는 다음 상태체크를 통과할 수 있지만 AWS는 문제를 감지했음을 나타내는 이벤트를 계속 기록한다. 

### Further reading

- Amazon CloudWatch 에서 사용할 수 있는 위에서 설명한 지표는 EBS 볼륨의 사용량과 성능을 추적하는 데 도움이 될 수 있지만 그림의 일부만 제공한다. 
- 예를 들어 디스크 사용량과 같은 시스템 수준 지표는 CloudWatch를 통해 사용할 수 없으므로 다른 방법을 사용하여 수집해야한다. 
- EBS 볼륨에 대한 통찰력을 제공할 수 있는 다른 지표 및 수집 방법에 대해 알아보려면 모니터링 가이드를 참조하라. 

- [key metrics for Amazon EBS monitoring](https://www.datadoghq.com/blog/amazon-ebs-monitoring/)
- [Collection EBS metrics](https://www.datadoghq.com/blog/collecting-amazon-ebs-metrics/)
- [Monitoring Amazon EBS volumes with Datadog](https://www.datadoghq.com/blog/monitoring-amazon-ebs-volumes-with-datadog/)

## Staying connected

- EBS 볼륨들은 가상화 된 네트워크 드라이브이다. 
- 이는 인스턴스 호스트에 붙어있는 물리적 장비가 아니다. 
- 디스크 성능은 네트워크 성능과 처리량에 강하게 결합되어 있따. 
- 몇몇 EC2 인스턴스 타입은 EBS 밴드위스를 일반 네트워크 활동에서 분리할 수 없다. 
- 이러한 케이스에서 만약 인스턴스가 인터넷의 사용자에게 정적 콘텐츠를 제공하는 것과 같이 다른 IP 트래픽에 상당한 대역폭을 할당하는 경우 EBS 볼륨에 사용할 수 있는 대역폭이 더 적기 때문에 디스크 성능이 제한될 수 있다. 

<br/>

- 많은 EC2인스턴스 타입들은 EBS 최적화되어 있으며 기본적으로 추가 비용이 발생하지 않는 경우가 많다.
- EBS최적화된 인스턴스는 425 ~ 14,000 Mbps 를 제공한다. (이는 인스턴스 타입에 의존한다.) 그리고 이는 EBS볼륨에 지정된 밴드위스가 할당되었다. 인스턴스의 다른 네트워크 활동과 분리한다. 
- AWS는 베이스라인의 특정 레벨을 보장하고, 특정 연동 동안 99%의 시간동안 보장된다. 
- 다른 인스턴스 유형은 네트워크 병목 현상을 방지하는 데 도움이 되는 향상된 네트워킹을 제공한다. 
- 그러나 이 인스턴스들은 모든 커뮤니케이션에 대해서 동일한 네트워크를 이용하며 이는 안정적인 네트워크 성능을 더욱 중요하게 만든다. 

<br/>

- EC2 인스턴스와 연결된 볼륨을 계획할 때 네트워크 구성과 서로 잘 맞는지 여부를 이해하는것이 중요하다. 
- 만약 대역폭 용량이 제한된 인스턴스에 처리량이 많은 EBS 볼륨이 여러 개 연결된 경우 드라이브가 최대 용량에 도달하지 않는다. 
- 예를 들어 r4.large 인스턴스의 최대 대역폭은 425Mbps 또는 약 53Mbps/s 의 처리량을 가진다. 
- 연결하는 EBS 볼륨의 수나 크기에 관계없이 인스턴스는 그보다 더 높은 처리량을 제공할 수 없으며 사용할 수 없는 용량에 대해 비용을 지불하게 된다. 

## Disk types

- EBS 볼륨은 특성이 다른 몇가지 유형으로 제공된다. 
- 워크로드 요구 사항을 이해하고 가장 적절한 볼륨 유형을 사용하면 애플리케이션 성능과 사용 요금 측면에서 큰 차이를 만들 수 있다. 
- 두가지 기본 범주는 솔리드 스테이트 드라이브와 하드드라이브이다. 

### SSD

- 초당 높은 I/O 처리를 위한 장비이다. 
- 작은 단위의 처리, 랜덤 오퍼레이션에서 성능 저하가 없다. 
- 각각 개별 I/O 크기, 블록크기가 작은 오퍼레이션에 뛰어남 크기는 256Kib 가 좋음
- SSD 볼륨은 General Purpose (gp2) 볼륨이 가능하며, 이는 버스트 IOPS 성능을 특정 기간동안 수행하도록 한다. 
- Provisioned IOPS (io1) 볼륨 은 사용자 지정 IOPS 요구사항을 유지 관리한다. 

### HDD

- SSD 볼륨은 IOPS에 강점이 있으나, HDD 볼륨은 높은 처리량이 필요한경우 유용하다. 
- HDD 장비는 헤드에서 물리적 위치까지 블록단위의 데이터를 저장한다. 
- 랜덤 액세스는 매우 느리지만, 큰 용량을 순차적인 I/O를 수행하는 경우에는 빠르고, 비용도 효과적이다. 
- 블록 사이트즌 1,24Kib를 관리할 수 있다. 
- 처리량 최적화된 St1 볼륨은 높은 처리량 성능을 제공한다. 
- Cold HDD (sc1) 보륨은 빈도수가 낮은 데이터 접근인경우 더 유리하다. 

### Finding the right combination

- 하나의 인스턴스에 서로다른 볼륨 타입을 연결할 수 있다. 이는 서로다른 유스케이스를 믹싱하는 경우 사용할 수 있다. 
- 예) 인스턴스가 높은 트랜잭션 데이터베이스를 운영할때 gp2 볼륨을 수행하고, 데이터베이스 로그를 sc1볼륨으로 롱텀 스토리지에 옯기는 작업을 하는 경우이다. 
- 올바른 EBS 볼륨을 설정하고 선택하는 것은 성능과, 비용 모두에서 엄청난 차이를 낼 수 있다. 

<br/>

- EBS 볼륨은 가상으로 프로비저닝된다. 
- 이 의미는 각 볼륨 타입의 성능 특성은 물리적 디스크 한계만이 기준이 아니다. 어떻게 AWS가 드라이브를 관리하느냐도 중요하다. 
- 최적화된 볼륨은 3가지 주요 팩터에 의해서 이해하고 밸런스를 가질 수 있다. IOPS, throughput, block size

- AWS에 명시된 제한은 SSD볼륨은 16Kib, HDD볼륨은 1,023Kib 의 I/O 블록 크기를 기준으로 한다. 
- 예) General Purpose SSD 볼륨은 최대 10,000 IOPS를 제공하며 16Kib 블록 크기를 사용한다면 최대 명시 Throughput은 160Mib/s 이다. 
- 만약 블록 크기가 더 커지면 볼륨은 최대 IOPS 를 달성하지 못한다. 왜냐하면 이미 throughput 제한에 걸려 버리기 때문이다. 
- 예) 블록 크기가 64Kib 인경우 160Mib/s 처리량 제한은 오직 2,500 IOPS인경우 달성할 수 있다. 

## What to look for with Amazon EBS monitoring

- EBS볼륨에 대한 모니터링은 어플리케이션의 헬스 상태 뿐만 아니라. 인스턴스와 볼륨 설정들이 적합한지 확인하고, 워크로드에 따라 선택적으로 수행할 수 있다. 
- 다음에는 메트릭의 3가지 메인 카테고리에 다음과 같다. 

- [Disk I/O](https://www.datadoghq.com/blog/amazon-ebs-monitoring/#disk-io)
- [Latency](https://www.datadoghq.com/blog/amazon-ebs-monitoring/#latency)
- [Disk activity](https://www.datadoghq.com/blog/amazon-ebs-monitoring/#disk-activity)

- 추가적으로 볼륨에 대한 상태에 대해서 리포팅 접근이 필요하다. 
- 유사하게 스케줄된 이벤트에 접근할 수 있으며 인스턴스의 상태와 가용성에 영향을 줄 것이다. 
- 실패된 볼륨 상태 체크는 원인에 대한 이벤트를 알려준다. 이를 추적하면 볼륨과 기본 AWS 시스템에 대한 상위 수준 보기가 제공된다. 
- EBS 볼륨 및 기타 AWS서비스에 대한 대부분의 리소스 지표를 확인하는 가장 쉬운 방법은 Amazon의 CloudWatch 모니터링 시스템을 사용하는 것이다. 
- 하지만 몇가지 고려점이 있다. 
- 첫째: 클라우드 워치는 다양한 기관과 다양한 계산을 사용하여 데이터를 집계할 수 있다. 
  - 기본적으로 CloudWatch 는 EBS 볼륨 메트릭을 5분 주기로 수집한다. io1 볼륨은 1분 단위로 지표를 게시한다.
  - 평균, 합계, 최대값 등과 같은 계산 또는 지계 방법은 해당 집계 기간동안 이러한 메트릭에 대한 다양한 정보를 제공한다. 
- 둘째: AWS는 대부분의 리소스를 지역별로 분리하므로 일반적으로 한번에 단일 지역 내의 볼륨에 대한 CloudWatch 지표만 볼 수 있다. 
- 마지막으로 클라우드 워치는 디스크 공간에 대한 리포트는 하지 않는다. 이 시리즈의 두번 째 부분에 디스크 공간 메트릭을 추적하는 몇가지 다른 방법을 살펴볼 것이다. 
- 이 아티클은 https://www.datadoghq.com/blog/monitoring-101-collecting-data 의 내용을 참조한다. 

### Disk I/O

- SSD와 HDD 2가지 볼륨 타입을 사용할 수 있다. 여기에는 2개의 기본 사항 및 상호 관련된 디스크 I/O메트릭 범주인 IOPS 및 처리량이 있다. 
- 실제 I/O 수준을 예상 워크로드와 비교하면 EBS 볼륨을 확장 또는 축소해야 하는지 또는 용량을 늘리거나 미사용 리소스에 대한 비용을 지불하지 않기 위해 다른 유형으로 전환해야 하는지 판단하는데 도움이 된다. 

<br/>

- 볼륨 IOPS 를 전체 처리량 및 평균 I/O 블록 크기와 연관 시키면 애플리케이션이 다른 볼륨 유형의 이점을 얻을 수 있다. 
- 이는 EBS가 I/O를 논리적으로 구성하는 방식 때문이다. 
- EBS 는 인접한 I/O 블록을 가능한 한 단일 단위로 병합을 시도한다. 
- SSD 볼륨은 SSD블록 크기를 256Kib 로 제한이 되어 있다는 것을 기억해야한다. 4개의 순차적인 128Kib 쓰기는 2개의 오퍼레이션으로 계산된다. 4개의 랜덤 128Kib 쓰기는 4개의 오퍼레이션으로 될 것이다. 
- 이는 성능에 매우 큰 영향을 준다. 동일한 예제를 HDD에 적용하면 블록 사이즈의 상한은 1,024Kib이다. 4개의 순차적인 128Kib 쓰기는 하나의 오퍼레이션으로 처리된다. 
- 그래서 이 케이스에서는 SSD 볼륨은 처리량 제한에 걸리게 된다. 이는 IOPS 용량 이하에서 수행되는 것이다. 
- 동일하게 작은 랜덤 I/O 오퍼레이션은 각각 계산된다. 이 의미는 처리량 수준이 상대적으로 낮게 유지되는 동안 IOPS 가 빠르게 추가될 수 있다. 

- VolumeReadOps and VolumeWriteOps	
  - 프롬에서 대상 볼륨으로 완료된 읽기/쓰기 오퍼레이션
  - Resource: Utilization
- VolumeReadBytes and VolumeWriteBytes	
  - 시작에서 읽고 대상 볼륨으로 쓴 바이트 단위
  - Resource: Utilization
- VolumeThroughputPercentage*	
  - 볼륨의 총 프로비져닝된 IOPS 중 제공된 IOPS의 퍼센트
  - Resource: Utilization
  - 오직 io1볼륨에서만 지원
- VolumeConsumedReadWriteOps*	
  - 시작에서 대상 볼륨으로 읽기/쓰기 오퍼레이션의 총 결합된 수 
  - Resource: Utilization
  - 오직 io1볼륨에서만 지원
  
### Metrics to watch: VolumeReadOps and VolumeWriteOps

- 이 메트릭은 집계 기간동안 수행된 읽기/쓰기 오퍼레이션의 총 수를 제공한다. 
- io1 볼륨에 대해서 기본적으로 1분이다. 다른 볼륨은 5분 주기로 집계된다. 
- 이 메트릭은 초당 제공된 IOPS로 정규화 된다. 이는 볼륨의 용량과 비교할 수 있다. 
- 가장 적절한 볼륨 유형을 사용하고 있는지 여부를 나타내는 것 외에도 IOPS 모니터링하면 애플리케이션 또는 인프라에서 발생할 수 있는 문제에 대한 통찰력을 제공한다. 
- 왜냐하면 EBS는 네트워크 스토리지이며, 다른 사용자와 공유된 인프라 자원이다. 높은 IOPS는 전체 latency 의 증가를 일으키지 않을 것이다. 
- 이 메트릭을 모니터링 하는 것은 오랜 요청 큐에 대해서 디스크 활동의 증가와 같은 트랜드를 보여준다. 이 의미는 큰 용량의 데이터를 처리하기 위해서는 어플리케이션에 캐싱 레이어가 필요하다는 것을 의미한다. 만약 특정 볼륨이 높은 읽기와 쓰기 레벨을 경험했고, 다른 서버는 쉬고 있다면 이는 application load balancer를 잘못 설정한 것이라고 판단할 수 있다. (혹은 로드 밸런서를 사용하고 있지 않거나 필요하다는 의미가 된다.)

### Metrics to watch: VolueReadBytes and VolumeWriteBytes

- 이 메트릭은 여러분의 볼륨에 의해서 전송된 데이터의 양에 대한 정보를 제공한다. 
- 이 정보는 요청하는 집계 방법에 따라 상당히 다른 결과를 나타낸다. 
- 평균은 블록 크기를 반환할 것이다. 각 I/O 오퍼레이션의 평균 크기일 수 도 있다. 일정 기간동안 모든 오퍼레이션에 대해서 걸린시간의 누적일수도 있다. 
- 이는 EBS볼륨이 처리하는 워크로드의 종류와 볼륨 유형이 애플리케이션에 잘 매칭되는지 확인하는데 사용된다.
- 예를 들어 어플리케이션이 General Purpose(gp2) SSD 볼륨에서 수행하고 있다면, 이 메트릭은 
- 이러한 메트릭에서 평균 I/O 크기가 256Kib(SSD 볼륨에 대해 가능한 가장 큰 블록 크기)보다 크고 일반적인 워크로드에 순차적 데이터 액세스가 포함되는 경우 st1 볼륨으로 전환하여 성능을 높일 수 있다. 
- 이는 st1 볼륨이 더 큰 순차 I/O 작업을 처리하는 데 더 적합하지만 gp2 볼륨은 더 작은 임의 I/O에 가장 적합하기 때문이다. 
- 한가지 주의 사항은 C5 및 M5 인스턴스에 연결된 볼륨의 경우 이러한 지표를 평균화하면 작업당이 아니라. 요청된ㄷ 기간 동안 읽거나 쓴 평균 바이트 수를 반환한다.
- 이러한 메트릭 중 하나의 평균 대신 합계를 요청하면 지정된 기간동안 읽거나 쓴 데이터의 용량이 표시된다. 
- 이는 전체 처리량 수준을 모니터링 하고 볼륨이 예상보다 많거나 적은 데이터를 처리하는 확인하는 좋은 방법이다. 
- 전체 처리량을 모니터링하면 인스턴스 자체의 대역폭 제한이 볼륨의 처리량을 제한할 수 있는지 확인하는 데도 도움이 된다. 

### Metric to watch: VolumeThroughputPercentage

- 프로비저닝된 IOPS 볼륨에만 적용됩니다. 
- 이 지표는 해당 기간 동안 제공되는 볼륨의 총 프로비저닝된 IOPS비율을 보고한다. 
- 이 지푤르 주시하면 볼륨에 대해 프로비저닝한 IOPS 수가 적절한 여부에 대한 간략한 요약을 제공할 수 있다. 
- 볼륨이 사용되는 동안 스냅샷을 생성하거나 볼륨이 연결된 인스턴스가 EBS에 최적화되지 않은 경우와 같은 특정 상황에서는 I/O 성능이 저하된것처럼 보일 수 있다. 
- 이 메트릭은 기본적으로 1분 으로 메트릭을 보고하는 io1 볼륨에만 사용할 수 있다. 
- 

### Metric to watch: VolumeConsumedReadWriteOps

- 오직 Provisioned IOPS 볼륨에만 적용된다. 
- 이 메트릭은 특정 기간동안 읽기/쓰기 오퍼레이션이 수행된 결합된 총 합이다. 
- 각 I/O 는 256Kib 블록에서 측정되며 더 작은 오퍼레이션은 라운드 업 되고, 더 큰 것은 256Kib로 분할되어 처리된다. 
- VolumeThroughputPercentage 와 같이 이 ㅔ트릭은 io1볼륨의 I/O 활동과 빠르게 비교할 수 있다. 이는 프로비젼된 IOPS의 수에 비해 얼마나 수행했는지 알려주는 것이다. 
- 이 메트릭은 오직 io1 볼륨에서만 지원되며, 1분 단위의 메트릭이다. 

## Latency

- EBS latency 는 메시지를 읽고/쓰기 위한 요청을 보내고 나서, 완료되기까지의 시간을 측정한다. 
- Latency는 어플리케이션이 높은 IOPS를 요구하는 경우 그리고 볼륨과 관련된 메트릭의 상관 관계를 통해서 성능 이슈를 확인하는데 도움을 준다. 

- VolumeTotalReadTime and VolumeTotalWriteTime
  - 초단위로 측정되며 특정 기간내에 모든 읽기/쓰기가 수행되기 까지 소요된 시간이다. 
  - Work: Performance

### Metrics to watch: VolumeTotalReadTime and VolumeTotalWriteTime

- 이 메트릭의 평균은 평균 시간을 반환한다. 
- 초 단위이며 오퍼레이션 완료까지의 시간이다. 
- C5, M5 인스턴스에 연결된 볼륨은 제외한다. 이들은 평균으로 아무값도 반환하지 않는다. 
- sum은 특정 기간동안 완료된 총 시간의 합계이다. 
- 만약 특정 기간동안 많은 동시 작업이 완료된다면 반환되는 시간이 기간보다 많을 수 있다. 

<br/>

- 위에서 언급한 것과 같이 AWS 사용자 간의 리소스 공유로 인해 작업당 지연 시간의 증가가 반드시 볼륨 문제의 지표가 아닐 수 있다. 
- 그러나 특히 VolumeReadOperations 및 VolumeWriteOperations 및 VolumeQueueLength와 같은 다른 지표와 관련하여 이러한 지표를 주시하면 볼륨이 어떻게 수행되고 있는지에 대한 일반적인 개요를 제공할 수 있다. 
- 특히 대기 시간의 증가는 볼륨이 IOPS제한에 도달한 결과일 수 있기 때문이다. 
- 만약 어플리케이션이 latency 이슈를 경험했다면 이 메트릭을 체크해보자. EBS 볼륨에 문제가 있다면 조정에 도움을 줄 것이다. 

## Disk activity

- 응용프로그램이 원활하게 실행되고 있는지 확인하는 것 이외에도 디스크 활동을 측정하면 사용하지 않는 리소스에 대한 비용을 지불하지 않도록 볼륨 사용량을 최적화 하는데 도움이 되는 정보를 제공할 수 있다. 
- 볼륨이 유휴 상태인지 또는 작업 대기열 길이가 0인지 (즉, 명령을 기다리는 데 시간을 소비하고 있는지)를 주시하는 것이 유용하다.

- VolumeQueueLength
  - 완료되기를 기다리는 읽기/쓰기 작업 수 
  - Resource: Saturation
- VolumeIdleTime
  - 초단위 시간, 읽기/쓰기 수행을 받지 않은 시간
  - Resource: Utilization
- BurstBalance
  - 버스트 버킷에서 사용 가능한 I/O 또는 처리량 크레딧의 백분율 
  - Resource: Utilization
  - gp2, st1 그리고 sc1 볼륨에만 적용 

### Metric to watch: Volume queue length

- 볼륨의 큐 길이, 실행을 대기하고 있는 펜딩된 오퍼레이션의 개수이다. 이는 지속적으로 IOPS 성능에 상당한 영향을 미칠 수 있다. 
- 빈 대기열이 이상적으로 들릴수 있다. 이는 볼륨이 유휴시간을 보내고 있다는 것을 의미하며, 해당 기간동안 IOPS 를 최적화 할 수 없어 본질적으로 리소스를 낭비하는 것을 가리킨다. 
- 반면에 요청을 대기열에 넣으면 자연스럽게 전체 latency가 늘어난다. 
- 볼륨의 대기열 길이를 IOPS 및 볼륨 읽기/쓰기 시간과 같은 다른 메트릭과 연관시키면 워크로드에 대한 적잘한 균형을 결정하는데 도움이 된다. 

<br/>

- 일반적으로 AWS는 볼륨 유형 및 워크로드 종류에 따라 최적의 성능을 위해 특정 볼륨 대기열 길이를 유지하도록 제안한다. 
- SSD 볼륨의 경험에 따르면 사용 가능한 IOPS 1,000 개당 1개의 대기열 길이를 목표로 한 다음 애플리케이션이 기준선 또는 프로비저닝된 IOPS에 도달할 때까지 대기열 길이를 모니터링 하고 늘리는 것이 좋다. 
- HDD 볼륨의 경우 대상에 대한 권장 시작 지점은 1Mib 순차 작업을 처리할 때 최소 4개의 대기열 길이이다. 
- 대기열 길이 조정은 사용 가능한 처리 용량을 조정하거나 볼륨 전체에 I/O 를 스트라이핑 하거나 단일 디스크가 수신하는 요청 수를 변경하도록 애플리케이션 구조를 조정하여 수행할 수 있다. 

### Metric to watch: Volume idle time

- 이상적으로 볼륨은 항상 무언가를 수행해야한다. 
- 이 메트릭을 모니터링 하여 비활성 시간을 보내고 프로비저닝된 리소스를 사용하지 않는 볼륨을 식별한다. 
- 만약 I/O 레벨이 예기지 않게 떨어지는 경우 볼륨 유휴 시간의 갑작스러운 증가는 요청이 볼륨으로 전송되지 않는 더 큰 애플리케이션 문제의 결과일 수 있다. 

### Metric to alert on: Burst balance

- 범용 SSD 처리량 최적화 HDD 및 콜드 HDD 볼륨에만 적용된다. 
- 버스팅은 사용 가능한 버스트 크리뎃이 있는한 볼륨이 더 높은 기준 성능 수준에서 작동할 수 있다. 
- 버스트 버킷은 IOPS(gp2 볼륨의 경우 최대 3,000IOPS) 또는 처리량 (st1의 경우 최대 500Mib/s sc1 볼륨의 경우 250Mib/s) 에 대한 버스팅을 제공하는 볼륨에 사용할 수 있는 크레딧의 균형이다. 
- 두 경우 모두 볼륨의 버스트 버킷은 볼륨의 기준 성능 수준과 동일한 속도로 크레딧을 보충한다. 
- 즉, 더 큰 볼륨은 버스트 버킷을 더 빨리 다시 채운다. 
- 이 측정 항목은 사용 가능한 크레딧의 백분율을 반환한다. 
- 볼륨이 예상보다 더 자주 버스트 버킷을 소모하는 경우 더 많은 기준 성능을 위해 더 높은 용량의 볼륨을 사용해야 하거나 일관된 IOPS 를 보장하기 위해 io1 볼륨으로 전환해야 함을 나타낼 수 있다. 
- 또한 충분히 큰 볼륨을 선택하여 버스트 성능 수준에 도달하고 초과할 수 있으므로 버스트 균형을 주로 작은 볼륨의 성능을 높이는 데 유용하게 사용할 수 있다. 

## Status check

- AWS는 자동적으로 EBS 볼륨에 상태 체크를 수행한다. 
- 이는 볼륨 I/O 상태와 데이터에 잠재적이 ㄴ무넺가 있는지 또는 io1 볼륨의 경우 볼륨 성능에 대한 높은 수준의 표시를 제공한다. 

- VolumeStatus
  - 일반적인 I/O 상태를 나타냄
  - Resource: Availability
- IOPerformance
  - 기대한 수준의 I/O 성능 츨정값
  - Resource: Availability
  - 오직 io1 볼륨에서만 사용가능 

### Metric to watch: Volume status

- 매 5분마다 볼륨에 대한 I/O 상태 확인을 실행한다. 
- 볼륨의 상태는 모든 검사가 통과하면 정상, 검사가 실패하면 손상됨, 검사가 완료되지 않은 경우 데이터 부족으로 나타남
- 측정된 성능이 예상보다 낮은 경우 프로비저닝된 IOPS볼륨은 추가 경고 값을 반환할 수 있다. 
- 이는 io1 볼륨이 스냅샷에서 초기화되는 경우일 수 있으며, 이 경우 성능 저하가 일시적이라 예상할 수 있다. 

<br/>

- AWS 가 볼륨 데이터의 가능한 불일치를 감지하면 잠재적인 손상을 방지하기 위해 기본적으로 해당 볼륨에 대한 추가 I/O 를 비활성화 한다. 
- 다음 볼륨 상태 확인이 실패하고 볼륨이 손상된 것으로 표시된다. 
- AWS는 볼륨이 I/O 를 수락하지 않는다는 것을 나타내는 이벤트도 생성한다. 
- 이 동작을 변경하고 문제가 있는 볼륨에 대해 I/O를 활성화된 상태로 유지할 수 있다. 
- 즉, 볼륨 상태 검사는 통과하지만 문제가 감지되었고 I/O가 활성화된 상태로 유지되었음을 나타내는 이벤트가 계속 생성된다. 

### I/O performance status

- 프로비저닝된 IOPS 볼륨에만 적용된다. 
- 이 검사는 실제 I/O 성능을 볼륨의 프로비저닝된 수준과 비교한다. 
- 이 검사에 대해 가능한 반환 값은 정상, 성능저하, 심각하게 성능 저하, 지연, 사용할 수 없음 (I/O가 비활성화 된 경우) 또는 데이터 부족으로 나타난다.

## Events

- 위에서 이야기한것과 같이 만약 볼륨 상태 체크가 실패하면 AWS는 이벤트를 발생시킨다. 
- 이 이벤트는 I/O가 비활성화 되었을 때의 볼륨 상태 및 타임스탬프에 대한 설명이 포함된다. 
- I/O가 다시 활성화 되는 시간을 표시하기 위해 다른 이벤트가 생성된다. 
- io1 볼륨의 경우 이벤트 설명은 I/O 성능 상태도 제공한다. 

<br/>

- EBS 볼륨과 관련괸 이벤트 외에도 EC2 이벤트를 모니터링하여 인스턴스 및 연결된 모든 데이터의 가용성 변경에 대한 정보를 지속적으로 받아야한다. 
- EBS 볼륨은 중지된 인스턴스에 연결되어 있어도 스토리지 요금이 계속 발생한다. 
- 그러므로 인스턴스가 중지되도록 예약 되어 있는지 여부를 모니터링 하면 볼륨을 새 인스턴스로 이동하거나 인프라를 조정할 수 있는 충분한 시간을 확보할 수 있다. 

## Disk space metrics

- CloudWatch 는 하이퍼바이즈를 통해서 지표를 수집하기 때문에 볼륨의 디스크 사용량과 같은 내부 시스템 수준 지표는 보고하지 않는다. 

